<!DOCTYPE html>
<html>
    <head>
        <title>Anagrafica collection oggetti</title>
    </head>
    <style>
        h1 {
            color: red;
            text-align: center;
            font-size: 15px;
            padding: 10 10 10 10;
            font-family: 'Times New Roman', Times, serif;
        }
    </style>
    <h1>Anagrafica collection oggetti</h1>
    Inserire gli utenti
    <input type="text" id="utentiDaInserire">
    <button onclick="generaAnagrafica()" value="clicca">clicca</button>
    
    <script>
        function validaNomeCognome(str) {
            const regex = /^[a-zA-Z\s]+$/;
            return regex.test(str);
        }
        
        function validaDataDiNascita(data) {
            const regex = /^\d{2}\/\d{2}\/\d{4}$/;
            return regex.test(data);
        }
        
        function validaIndirizzo(indirizzo) {
            const regex = /^[a-zA-Z\s]+$/;
            return regex.test(indirizzo);
        }
        
        function validaEmail(email) {
            const regex = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
            return regex.test(email);
        }
        
        function validaPassword(password) {
            const regex = /^(?=.*[A-Za-z])(?=.*\d)(?=.*[!@#$%^&*])[A-Za-z\d!@#$%^&*]{10,}$/;
            return regex.test(password);
        }
        
        function generaAnagrafica() {
            let utentiDaInserire = parseInt(document.getElementById("utentiDaInserire").value, 10);
            const dati = [];
        
            for (let i = 0; i < utentiDaInserire; i++) {
                let nome;
                do {
                    nome = prompt('inserisci il nome della persona utente');
                    if (nome == null) {
                        alert('esecuzione interrotta');
                        return;
                    }
                    if (!validaNomeCognome(nome)) {
                        alert('notata la presenza di numeri o caratteri speciali, inserisci nel nome solo lettere e spazi (nei casi eccezionali)');
                    }
                } while (!validaNomeCognome(nome));
        
                dati.push(nome);
        
                let cognome;
                do {
                    cognome = prompt('inserisci il cognome della persona utente');
                    if (cognome == null) {
                        alert('esecuzione interrotta');
                        return;
                    }
                    if (!validaNomeCognome(cognome)) {
                        alert('notata la presenza di numeri o caratteri speciali, inserisci nel cognome solo lettere e spazi');
                    }
                } while (!validaNomeCognome(cognome));
        
                dati.push(cognome);
        
                let dataDiNascita;
                do {
                    dataDiNascita = prompt('inserisci la data di nascita nel seguente formato giorno/mese/anno');
                    if (dataDiNascita == null) {
                        alert('esecuzione interrotta');
                        return;
                    }
                    if (!validaDataDiNascita(dataDiNascita)) {
                        alert('data di nascita fornita non è valida, inseriscila nel formato giorno/mese/anno');
                    }
                } while (!validaDataDiNascita(dataDiNascita));
        
                dati.push(dataDiNascita);
        
                let indirizzo;
                do {
                    indirizzo = prompt('inserisci la via della persona utente');
                    if (indirizzo == null) {
                        alert('esecuzione interrotta');
                        return;
                    }
                } while (!indirizzo);
        
                dati.push(indirizzo);
        
                let email;
                do {
                    email = prompt('inserisci la mail della persona utente');
                    if (email == null) {
                        alert('esecuzione interrotta');
                        return;
                    }
                    if (!validaEmail(email)) {
                        alert('la email fornita non è valida, inserisci una mail corretta');
                    }
                } while (!validaEmail(email));
        
                dati.push(email);
        
                let password;
                do {
                    password = prompt('inserisci la password della mail della persona utente');
                    if (password == null) {
                        alert('esecuzione interrotta');
                        return;
                    }
                    if (!validaPassword(password)) {
                        alert('la password fornita non è valida, deve avere almeno 10 caratteri, almeno una maiuscola, le minuscole, dei numeri e almeno un carattere speciale');
                    }
                } while (!validaPassword(password));
        
                dati.push(password);
            }

            localStorage.setItem('datiUtenti', JSON.stringify(dati));
            location.href = 'risultatoAnagrafica.html';
        }
    </script>            
</html>
